import React, { useState, useRef, useEffect } from "react";

// Emoji categories and emojis
const EMOJI_CATEGORIES = {
  "ðŸ˜€": ["ðŸ˜€", "ðŸ˜ƒ", "ðŸ˜„", "ðŸ˜", "ðŸ˜†", "ðŸ˜…", "ðŸ˜‚", "ðŸ¤£", "ðŸ˜Š", "ðŸ˜‡", "ðŸ™‚", "ðŸ™ƒ", "ðŸ˜‰", "ðŸ˜Œ", "ðŸ˜", "ðŸ¥°", "ðŸ˜˜", "ðŸ˜—", "ðŸ˜™", "ðŸ˜š", "ðŸ˜‹", "ðŸ˜›", "ðŸ˜", "ðŸ˜œ", "ðŸ¤ª", "ðŸ¤¨", "ðŸ§", "ðŸ¤“", "ðŸ˜Ž", "ðŸ¤©", "ðŸ¥³", "ðŸ˜", "ðŸ˜’", "ðŸ˜ž", "ðŸ˜”", "ðŸ˜Ÿ", "ðŸ˜•", "ðŸ™", "â˜¹ï¸", "ðŸ˜£", "ðŸ˜–", "ðŸ˜«", "ðŸ˜©", "ðŸ¥º", "ðŸ˜¢", "ðŸ˜­", "ðŸ˜¤", "ðŸ˜ ", "ðŸ˜¡", "ðŸ¤¬", "ðŸ¤¯", "ðŸ˜³", "ðŸ¥µ", "ðŸ¥¶", "ðŸ˜±", "ðŸ˜¨", "ðŸ˜°", "ðŸ˜¥", "ðŸ˜“"],
  "ðŸ‘‹": ["ðŸ‘‹", "ðŸ¤š", "ðŸ–", "âœ‹", "ðŸ––", "ðŸ‘Œ", "ðŸ¤Œ", "ðŸ¤", "âœŒï¸", "ðŸ¤ž", "ðŸ¤Ÿ", "ðŸ¤˜", "ðŸ¤™", "ðŸ‘ˆ", "ðŸ‘‰", "ðŸ‘†", "ðŸ–•", "ðŸ‘‡", "â˜ï¸", "ðŸ‘", "ðŸ‘Ž", "âœŠ", "ðŸ‘Š", "ðŸ¤›", "ðŸ¤œ", "ðŸ‘", "ðŸ™Œ", "ðŸ‘", "ðŸ¤²", "ðŸ¤", "ðŸ™", "âœï¸", "ðŸ’ª", "ðŸ¦¾", "ðŸ¦¿", "ðŸ¦µ", "ðŸ¦¶", "ðŸ‘‚", "ðŸ¦»", "ðŸ‘ƒ", "ðŸ§ ", "ðŸ«€", "ðŸ«", "ðŸ¦·", "ðŸ¦´", "ðŸ‘€", "ðŸ‘ï¸", "ðŸ‘…", "ðŸ‘„"],
  "â¤ï¸": ["â¤ï¸", "ðŸ§¡", "ðŸ’›", "ðŸ’š", "ðŸ’™", "ðŸ’œ", "ðŸ–¤", "ðŸ¤", "ðŸ¤Ž", "ðŸ’”", "â£ï¸", "ðŸ’•", "ðŸ’ž", "ðŸ’“", "ðŸ’—", "ðŸ’–", "ðŸ’˜", "ðŸ’", "ðŸ’Ÿ", "â˜®ï¸", "âœï¸", "â˜ªï¸", "ðŸ•‰", "â˜¸ï¸", "âœ¡ï¸", "ðŸ”¯", "ðŸ•Ž", "â˜¯ï¸", "â˜¦ï¸", "ðŸ›", "â›Ž", "â™ˆ", "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™Ž", "â™", "â™", "â™‘", "â™’", "â™“", "ðŸ†”", "âš›ï¸", "ðŸ‰‘", "â˜¢ï¸", "â˜£ï¸"],
  "ðŸŒ": ["ðŸŒ", "ðŸŒŽ", "ðŸŒ", "ðŸŒ", "ðŸ—ºï¸", "ðŸ§­", "ðŸ”ï¸", "â›°ï¸", "ðŸŒ‹", "ðŸ—»", "ðŸ•ï¸", "ðŸ–ï¸", "ðŸœï¸", "ðŸï¸", "ðŸžï¸", "ðŸŸï¸", "ðŸ›ï¸", "ðŸ—ï¸", "ðŸ§±", "ðŸ˜ï¸", "ðŸšï¸", "ðŸ ", "ðŸ¡", "ðŸ¢", "ðŸ£", "ðŸ¤", "ðŸ¥", "ðŸ¦", "ðŸ¨", "ðŸ©", "ðŸª", "ðŸ«", "ðŸ¬", "ðŸ­", "ðŸ¯", "ðŸ°", "ðŸ’’", "ðŸ—¼", "ðŸ—½", "â›ª", "ðŸ•Œ", "ðŸ›•", "ðŸ•", "â›©ï¸", "ðŸ•‹", "â›²", "â›º", "ðŸŒ", "ðŸŒƒ", "ðŸ™ï¸", "ðŸŒ„", "ðŸŒ…", "ðŸŒ†", "ðŸŒ‡", "ðŸŒ‰", "â™¨ï¸", "ðŸŽ ", "ðŸŽ¡", "ðŸŽ¢", "ðŸ’ˆ", "ðŸŽª", "ðŸš‚", "ðŸšƒ", "ðŸš„", "ðŸš…", "ðŸš†", "ðŸš‡", "ðŸšˆ", "ðŸš‰", "ðŸšŠ", "ðŸš", "ðŸšž", "ðŸš‹", "ðŸšŒ", "ðŸš", "ðŸšŽ", "ðŸš", "ðŸš‘", "ðŸš’", "ðŸš“", "ðŸš”", "ðŸš•", "ðŸš–", "ðŸš—", "ðŸš˜", "ðŸš™", "ðŸšš", "ðŸš›", "ðŸšœ", "ðŸŽï¸", "ðŸï¸", "ðŸ›µ", "ðŸ¦½", "ðŸ¦¼", "ðŸ›´", "ðŸš²", "ðŸ›´", "ðŸ›¹", "ðŸ›¼", "ðŸš", "ðŸ›¸", "âœˆï¸", "ðŸ›«", "ðŸ›¬", "ðŸª‚", "ðŸ’º", "ðŸš€", "ðŸš¤", "â›µ", "ðŸ›¥ï¸", "ðŸ›³ï¸", "â›´ï¸", "ðŸš¢", "âš“", "â›½", "ðŸš§", "ðŸš¦", "ðŸš¥", "ðŸ—ºï¸", "ðŸ—¿", "ðŸ—½", "ðŸ—¼", "ðŸ°", "ðŸ¯", "ðŸŸï¸", "ðŸŽ¡", "ðŸŽ¢", "ðŸŽ ", "â›²", "â›±ï¸", "ðŸ–ï¸", "ðŸï¸", "ðŸœï¸", "ðŸŒ‹", "â›°ï¸", "ðŸ”ï¸", "ðŸ—»", "ðŸ•ï¸", "â›º", "ðŸ ", "ðŸ¡", "ðŸ˜ï¸", "ðŸšï¸", "ðŸ—ï¸", "ðŸ­", "ðŸ¢", "ðŸ¬", "ðŸ£", "ðŸ¤", "ðŸ¥", "ðŸ¦", "ðŸ¨", "ðŸª", "ðŸ«", "ðŸ©", "ðŸ’’", "ðŸ›ï¸", "â›ª", "ðŸ•Œ", "ðŸ•", "ðŸ›•", "ðŸ•‹", "â›©ï¸", "ðŸ›¤ï¸", "ðŸ›£ï¸", "ðŸ—¾", "ðŸŽ‘", "ðŸžï¸", "ðŸŒ…", "ðŸŒ„", "ðŸŒ ", "ðŸŽ‡", "ðŸŽ†", "ðŸŒ‡", "ðŸŒ†", "ðŸ™ï¸", "ðŸŒƒ", "ðŸŒŒ", "ðŸŒ‰", "ðŸŒ"],
  "ðŸ•": ["ðŸ•", "ðŸ”", "ðŸŸ", "ðŸŒ­", "ðŸ¿", "ðŸ§‚", "ðŸ¥“", "ðŸ¥š", "ðŸ³", "ðŸ¥ž", "ðŸ¥", "ðŸ¥¨", "ðŸ§€", "ðŸ¥–", "ðŸ¥¯", "ðŸ¥ª", "ðŸŒ®", "ðŸŒ¯", "ðŸ¥™", "ðŸ¥«", "ðŸ", "ðŸœ", "ðŸ²", "ðŸ›", "ðŸ£", "ðŸ±", "ðŸ¥Ÿ", "ðŸ¤", "ðŸ™", "ðŸš", "ðŸ˜", "ðŸ¥", "ðŸ¥ ", "ðŸ¥®", "ðŸ¢", "ðŸ¡", "ðŸ§", "ðŸ¨", "ðŸ¦", "ðŸ¥§", "ðŸ§", "ðŸ°", "ðŸŽ‚", "ðŸ®", "ðŸ­", "ðŸ¬", "ðŸ«", "ðŸ¿", "ðŸ©", "ðŸª", "ðŸŒ°", "ðŸ¥œ", "ðŸ¯", "ðŸ¥›", "ðŸ¼", "â˜•ï¸", "ðŸµ", "ðŸ¥¤", "ðŸ¶", "ðŸº", "ðŸ»", "ðŸ¥‚", "ðŸ·", "ðŸ¥ƒ", "ðŸ¸", "ðŸ¹", "ðŸ§ƒ", "ðŸ§‰", "ðŸ§Š", "ðŸ¥¢", "ðŸ½ï¸", "ðŸ´", "ðŸ¥„", "ðŸ”ª", "ðŸº"],
  "âš½": ["âš½", "ðŸ€", "ðŸˆ", "âš¾", "ðŸ¥Ž", "ðŸŽ¾", "ðŸ", "ðŸ‰", "ðŸ¥", "ðŸŽ±", "ðŸ“", "ðŸ¸", "ðŸ¥…", "ðŸ’", "ðŸ‘", "ðŸ", "ðŸ¥", "ðŸ¹", "ðŸŽ£", "ðŸ¥Š", "ðŸ¥‹", "ðŸŽ½", "ðŸ›¹", "ðŸ›·", "â›¸ï¸", "ðŸ¥Œ", "ðŸŽ¿", "â›·ï¸", "ðŸ‚", "ðŸ‹ï¸", "ðŸ¤¼", "ðŸ¤¸", "ðŸ¤º", "â›¹ï¸", "ðŸ¤¾", "ðŸŒï¸", "ðŸ‡", "ðŸ§˜", "ðŸ„", "ðŸŠ", "ðŸš£", "ðŸ§—", "ðŸšµ", "ðŸš´", "ðŸ†", "ðŸ¥‡", "ðŸ¥ˆ", "ðŸ¥‰", "ðŸ…", "ðŸŽ–ï¸", "ðŸµï¸", "ðŸŽ—ï¸", "ðŸŽ«", "ðŸŽŸï¸", "ðŸŽª", "ðŸ¤¹", "ðŸŽ­", "ðŸ©°", "ðŸŽ¨", "ðŸŽ¬", "ðŸŽ¤", "ðŸŽ§", "ðŸŽ¼", "ðŸŽ¹", "ðŸ¥", "ðŸŽ·", "ðŸŽº", "ðŸŽ¸", "ðŸª•", "ðŸŽ»", "ðŸŽ²", "â™Ÿï¸", "ðŸŽ¯", "ðŸŽ³", "ðŸŽ®", "ðŸŽ°", "ðŸ§©"],
  "ðŸ›ï¸": ["ðŸ›ï¸", "ðŸ›’", "ðŸ›ï¸", "ðŸ›‹ï¸", "ðŸš¿", "ðŸ›", "ðŸ§´", "ðŸ§·", "ðŸ§¹", "ðŸ§º", "ðŸ§»", "ðŸ§¼", "ðŸ§½", "ðŸ§¯", "ðŸ›’", "ðŸš¬", "âš°ï¸", "âš±ï¸", "ðŸ—¿", "ðŸ§", "ðŸš®", "ðŸš°", "â™¿", "ðŸš¹", "ðŸšº", "ðŸš»", "ðŸš¼", "ðŸš¾", "ðŸ›‚", "ðŸ›ƒ", "ðŸ›„", "ðŸ›…", "âš ï¸", "ðŸš¸", "â›”", "ðŸš«", "ðŸš³", "ðŸš­", "ðŸš¯", "ðŸš±", "ðŸš·", "ðŸ“µ", "ðŸ”ž", "â˜¢ï¸", "â˜£ï¸", "â¬†ï¸", "â†—ï¸", "âž¡ï¸", "â†˜ï¸", "â¬‡ï¸", "â†™ï¸", "â¬…ï¸", "â†–ï¸", "â†•ï¸", "â†”ï¸", "ðŸ”„", "â†ªï¸", "â¤´ï¸", "â¤µï¸", "ðŸ”ƒ", "ðŸ”™", "ðŸ”š", "ðŸ”›", "ðŸ”œ", "ðŸ”", "ðŸ›", "âš›ï¸", "ðŸ•‰ï¸", "â˜¸ï¸", "â˜®ï¸", "â˜¯ï¸", "â˜ªï¸", "âœ¡ï¸", "ðŸ”¯", "ðŸ•Ž", "â˜¦ï¸", "âœï¸", "â˜¨", "â˜©", "â˜§", "â˜¬", "â˜­", "âšš", "â˜¤", "â˜¥", "â˜¦", "â˜§", "â˜¨", "â˜©", "â˜ª", "â˜«", "â˜¬", "â˜­", "â˜®", "â˜¯", "â˜°", "â˜±", "â˜²", "â˜³", "â˜´", "â˜µ", "â˜¶", "â˜·"],
  "ðŸ”¢": ["0ï¸âƒ£", "1ï¸âƒ£", "2ï¸âƒ£", "3ï¸âƒ£", "4ï¸âƒ£", "5ï¸âƒ£", "6ï¸âƒ£", "7ï¸âƒ£", "8ï¸âƒ£", "9ï¸âƒ£", "ðŸ”Ÿ", "ðŸ”¢", "#ï¸âƒ£", "*ï¸âƒ£", "â–¶ï¸", "â¸ï¸", "â¯ï¸", "â¹ï¸", "âºï¸", "â­ï¸", "â®ï¸", "â©", "âª", "â«", "â¬", "â—€ï¸", "ðŸ”¼", "ðŸ”½", "âž¡ï¸", "â¬…ï¸", "â¬†ï¸", "â¬‡ï¸", "â†—ï¸", "â†˜ï¸", "â†™ï¸", "â†–ï¸", "â†•ï¸", "â†”ï¸", "â†ªï¸", "â†©ï¸", "â¤´ï¸", "â¤µï¸", "ðŸ”€", "ðŸ”", "ðŸ”‚", "ðŸ”„", "ðŸ”ƒ", "ðŸŽµ", "ðŸŽ¶", "âž•", "âž–", "âž—", "âœ–ï¸", "â™¾ï¸", "ðŸ’²", "ðŸ’±", "â„¢ï¸", "Â©ï¸", "Â®ï¸", "ã€°ï¸", "âž°", "âž¿", "ðŸ”š", "ðŸ”™", "ðŸ”›", "ðŸ”œ", "ðŸ”", "ã€½ï¸", "âš ï¸", "ðŸš¸", "âš¡", "ðŸ”¥", "ðŸ’§", "ðŸŒŠ"]
};

// All emojis in a flat array for search
const ALL_EMOJIS = Object.values(EMOJI_CATEGORIES).flat();

const EmojiPicker = ({ onEmojiSelect, onClose }) => {
  const [activeCategory, setActiveCategory] = useState("ðŸ˜€");
  const [searchQuery, setSearchQuery] = useState("");
  const pickerRef = useRef(null);

  // Close picker when clicking outside
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (pickerRef.current && !pickerRef.current.contains(event.target)) {
        onClose();
      }
    };

    document.addEventListener("mousedown", handleClickOutside);
    return () => {
      document.removeEventListener("mousedown", handleClickOutside);
    };
  }, [onClose]);

  // Filter emojis based on search
  const getFilteredEmojis = () => {
    if (!searchQuery.trim()) {
      return EMOJI_CATEGORIES[activeCategory] || [];
    }
    
    // Search in all emojis
    return ALL_EMOJIS.filter(emoji => 
      emoji.includes(searchQuery) || 
      searchQuery.toLowerCase().includes(emoji)
    );
  };

  const handleEmojiClick = (emoji) => {
    onEmojiSelect(emoji);
  };

  return (
    <div 
      ref={pickerRef}
      className="absolute bottom-full left-0 mb-2 bg-white rounded-lg shadow-2xl border border-gray-200 w-80 h-96 flex flex-col z-50"
    >
      {/* Search Bar */}
      <div className="p-3 border-b border-gray-200">
        <input
          type="text"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
          placeholder="Search emojis..."
          className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-[#25D366] focus:border-transparent"
          onClick={(e) => e.stopPropagation()}
        />
      </div>

      {/* Category Tabs */}
      {!searchQuery && (
        <div className="flex border-b border-gray-200 overflow-x-auto">
          {Object.keys(EMOJI_CATEGORIES).map((category) => (
            <button
              key={category}
              onClick={() => setActiveCategory(category)}
              className={`px-3 py-2 text-lg border-b-2 transition ${
                activeCategory === category
                  ? "border-[#25D366] bg-gray-50"
                  : "border-transparent hover:bg-gray-50"
              }`}
            >
              {category}
            </button>
          ))}
        </div>
      )}

      {/* Emoji Grid */}
      <div className="flex-1 overflow-y-auto p-3">
        <div className="grid grid-cols-8 gap-1">
          {getFilteredEmojis().map((emoji, index) => (
            <button
              key={`${emoji}-${index}`}
              onClick={() => handleEmojiClick(emoji)}
              className="w-8 h-8 text-lg hover:bg-gray-100 rounded transition flex items-center justify-center"
              title={emoji}
            >
              {emoji}
            </button>
          ))}
        </div>
        {getFilteredEmojis().length === 0 && (
          <div className="text-center text-gray-500 py-8">
            No emojis found
          </div>
        )}
      </div>
    </div>
  );
};

export default EmojiPicker;

